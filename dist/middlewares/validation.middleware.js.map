{"version":3,"sources":["../../src/middlewares/validation.middleware.ts"],"sourcesContent":["import { plainToInstance } from 'class-transformer';\r\nimport { validateOrReject, ValidationError } from 'class-validator';\r\nimport { NextFunction, Request, Response } from 'express';\r\nimport { HttpException } from '@exceptions/HttpException';\r\n\r\n/**\r\n * @name ValidationMiddleware\r\n * @description Allows use of decorator and non-decorator based validation\r\n * @param type dto\r\n * @param skipMissingProperties When skipping missing properties\r\n * @param whitelist Even if your object is an instance of a validation class it can contain additional properties that are not defined\r\n * @param forbidNonWhitelisted If you would rather to have an error thrown when any non-whitelisted properties are present\r\n */\r\nexport const ValidationMiddleware = (type: any, skipMissingProperties = false, whitelist = false, forbidNonWhitelisted = false) => {\r\n  return (req: Request, res: Response, next: NextFunction) => {\r\n    const dto = plainToInstance(type, req.body);\r\n    validateOrReject(dto, { skipMissingProperties, whitelist, forbidNonWhitelisted })\r\n      .then(() => {\r\n        req.body = dto;\r\n        next();\r\n      })\r\n      .catch((errors: ValidationError[]) => {\r\n        const message = errors.map((error: ValidationError) => Object.values(error.constraints)).join(', ');\r\n        next(new HttpException(400, message));\r\n      });\r\n  };\r\n};\r\n"],"names":["ValidationMiddleware","type","skipMissingProperties","whitelist","forbidNonWhitelisted","req","res","next","dto","plainToInstance","body","validateOrReject","then","catch","errors","message","map","error","Object","values","constraints","join","HttpException"],"mappings":";;;;+BAaaA;;aAAAA;;kCAbmB;gCACkB;+BAEpB;AAUvB,MAAMA,uBAAuB,CAACC,MAAWC,wBAAwB,KAAK,EAAEC,YAAY,KAAK,EAAEC,uBAAuB,KAAK,GAAK;IACjI,OAAO,CAACC,KAAcC,KAAeC,OAAuB;QAC1D,MAAMC,MAAMC,IAAAA,iCAAe,EAACR,MAAMI,IAAIK,IAAI;QAC1CC,IAAAA,gCAAgB,EAACH,KAAK;YAAEN;YAAuBC;YAAWC;QAAqB,GAC5EQ,IAAI,CAAC,IAAM;YACVP,IAAIK,IAAI,GAAGF;YACXD;QACF,GACCM,KAAK,CAAC,CAACC,SAA8B;YACpC,MAAMC,UAAUD,OAAOE,GAAG,CAAC,CAACC,QAA2BC,OAAOC,MAAM,CAACF,MAAMG,WAAW,GAAGC,IAAI,CAAC;YAC9Fd,KAAK,IAAIe,4BAAa,CAAC,KAAKP;QAC9B;IACJ;AACF"}