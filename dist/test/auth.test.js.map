{"version":3,"sources":["../../src/test/auth.test.ts"],"sourcesContent":["import bcrypt from 'bcrypt';\r\nimport request from 'supertest';\r\nimport { createConnection, getConnection, Repository } from 'typeorm';\r\nimport { App } from '@/app';\r\nimport { dbConnection } from '@databases';\r\nimport { CreateUserDto } from '@dtos/users.dto';\r\nimport { UserEntity } from '@entities/users.entity';\r\nimport { AuthRoute } from '@routes/auth.route';\r\n\r\n// beforeAll(async () => {\r\n//   await createConnection(dbConnection);\r\n// });\r\n\r\nafterAll(async () => {\r\n  await getConnection().close();\r\n});\r\n\r\ndescribe('Testing Auth', () => {\r\n  describe('[POST] /signup', () => {\r\n    it('response should have the Create userData', async () => {\r\n      const userData: CreateUserDto = {\r\n        email: 'test@email.com',\r\n        password: 'q1w2e3r4!',\r\n      };\r\n\r\n      const authRoute = new AuthRoute();\r\n      const userRepository = new Repository<UserEntity>();\r\n\r\n      userRepository.findOne = jest.fn().mockReturnValue(null);\r\n      userRepository.save = jest.fn().mockReturnValue({\r\n        id: 1,\r\n        email: userData.email,\r\n        password: await bcrypt.hash(userData.password, 10),\r\n      });\r\n\r\n      const app = new App([authRoute]);\r\n      return request(app.getServer()).post(`${authRoute.path}signup`).send(userData).expect(201);\r\n    });\r\n  });\r\n\r\n  describe('[POST] /login', () => {\r\n    it('response should have the Set-Cookie header with the Authorization token', async () => {\r\n      const userData: CreateUserDto = {\r\n        email: 'test@email.com',\r\n        password: 'q1w2e3r4!',\r\n      };\r\n\r\n      const authRoute = new AuthRoute();\r\n      const userRepository = new Repository<UserEntity>();\r\n\r\n      userRepository.findOne = jest.fn().mockReturnValue({\r\n        id: 1,\r\n        email: userData.email,\r\n        password: await bcrypt.hash(userData.password, 10),\r\n      });\r\n\r\n      const app = new App([authRoute]);\r\n      return request(app.getServer())\r\n        .post(`${authRoute.path}login`)\r\n        .send(userData)\r\n        .expect('Set-Cookie', /^Authorization=.+/);\r\n    });\r\n  });\r\n\r\n  // describe('[POST] /logout', () => {\r\n  //   it('logout Set-Cookie Authorization=; Max-age=0', async () => {\r\n  //     const authRoute = new AuthRoute();\r\n  //     const app = new App([authRoute]);\r\n\r\n  //     return request(app.getServer())\r\n  //       .post(`${authRoute.path}logout`)\r\n  //       .expect('Set-Cookie', /^Authorization=\\;/);\r\n  //   });\r\n  // });\r\n});\r\n"],"names":["afterAll","getConnection","close","describe","it","userData","email","password","authRoute","AuthRoute","userRepository","Repository","findOne","jest","fn","mockReturnValue","save","id","bcrypt","hash","app","App","request","getServer","post","path","send","expect"],"mappings":";;;;iDAAmB;oDACC;yBACwC;qBACxC;2BAIM;;;;;;AAM1BA,SAAS,UAAY;IACnB,MAAMC,IAAAA,sBAAa,IAAGC,KAAK;AAC7B;AAEAC,SAAS,gBAAgB,IAAM;IAC7BA,SAAS,kBAAkB,IAAM;QAC/BC,GAAG,4CAA4C,UAAY;YACzD,MAAMC,WAA0B;gBAC9BC,OAAO;gBACPC,UAAU;YACZ;YAEA,MAAMC,YAAY,IAAIC,oBAAS;YAC/B,MAAMC,iBAAiB,IAAIC,mBAAU;YAErCD,eAAeE,OAAO,GAAGC,KAAKC,EAAE,GAAGC,eAAe,CAAC,IAAI;YACvDL,eAAeM,IAAI,GAAGH,KAAKC,EAAE,GAAGC,eAAe,CAAC;gBAC9CE,IAAI;gBACJX,OAAOD,SAASC,KAAK;gBACrBC,UAAU,MAAMW,eAAM,CAACC,IAAI,CAACd,SAASE,QAAQ,EAAE;YACjD;YAEA,MAAMa,MAAM,IAAIC,QAAG,CAAC;gBAACb;aAAU;YAC/B,OAAOc,IAAAA,kBAAO,EAACF,IAAIG,SAAS,IAAIC,IAAI,CAAC,CAAC,EAAEhB,UAAUiB,IAAI,CAAC,MAAM,CAAC,EAAEC,IAAI,CAACrB,UAAUsB,MAAM,CAAC;QACxF;IACF;IAEAxB,SAAS,iBAAiB,IAAM;QAC9BC,GAAG,2EAA2E,UAAY;YACxF,MAAMC,WAA0B;gBAC9BC,OAAO;gBACPC,UAAU;YACZ;YAEA,MAAMC,YAAY,IAAIC,oBAAS;YAC/B,MAAMC,iBAAiB,IAAIC,mBAAU;YAErCD,eAAeE,OAAO,GAAGC,KAAKC,EAAE,GAAGC,eAAe,CAAC;gBACjDE,IAAI;gBACJX,OAAOD,SAASC,KAAK;gBACrBC,UAAU,MAAMW,eAAM,CAACC,IAAI,CAACd,SAASE,QAAQ,EAAE;YACjD;YAEA,MAAMa,MAAM,IAAIC,QAAG,CAAC;gBAACb;aAAU;YAC/B,OAAOc,IAAAA,kBAAO,EAACF,IAAIG,SAAS,IACzBC,IAAI,CAAC,CAAC,EAAEhB,UAAUiB,IAAI,CAAC,KAAK,CAAC,EAC7BC,IAAI,CAACrB,UACLsB,MAAM,CAAC,cAAc;QAC1B;IACF;AAYF"}